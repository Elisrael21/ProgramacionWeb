<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Consulta de Crédito</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .rojo { color: red; font-weight: bold; }
    .amarillo { color: orange; font-weight: bold; }
    .verde { color: green; font-weight: bold; }
    #score, #meses { width: 100%; }
  </style>
</head>
<body class="container mt-4">
  <h2 class="mb-4">Formulario de Consulta de Crédito</h2>
  
  <form class="row g-3">
    <div class="col-md-6">
      <label class="form-label">Edad</label>
      <input type="number" id="edad" class="form-control" placeholder="Ingresa tu edad" min="18" max="100" required>
    </div>
    
    <div class="col-md-6">
      <label class="form-label">Ingresos mensuales</label>
      <input type="number" id="ingresos" class="form-control" placeholder="Ingresa tu ingreso mensual" step="100" required>
    </div>
    
    <div class="col-md-6">
      <label class="form-label">Buró de crédito</label>
      <input type="text" id="buro" class="form-control" readonly>
    </div>
    
    <div class="col-md-6">
      <label class="form-label">Score crediticio</label>
      <input type="range" id="score" min="0" max="1000" step="10" value="500"
             oninput="actualizarScore(this.value)" class="form-range">
      <span id="valorScore" class="fw-bold">500</span>
    </div>
    
    <div class="col-md-6">
      <label class="form-label">Monto a prestar</label>
      <input type="number" id="monto" class="form-control" placeholder="Ingresa el monto solicitado" step="1000" required>
    </div>
    
    <div class="col-md-6">
      <label class="form-label">Meses a pagar</label>
      <input type="range" id="meses" min="2" max="24" step="2" value="12"
             oninput="document.getElementById('valorMeses').textContent=this.value" class="form-range">
      <span id="valorMeses" class="fw-bold">12</span>
    </div>
    
    <div class="col-12">
      <button type="button" class="btn btn-primary" onclick="calcular()">Calcular</button>
    </div>
  </form>
  
  <div class="resultado mt-4" id="resultado"></div>
  <div id="tablaPagos" class="mt-3"></div>
  
  <script>
    function actualizarScore(valor) {
      const span = document.getElementById('valorScore');
      const buro = document.getElementById('buro');
      const barra = document.getElementById('score');
      
      span.textContent = valor;
      
      if (valor <= 333) {
        span.className = "rojo fw-bold";
        buro.value = "Malo";
        barra.style.background = "red";
      } else if (valor <= 666) {
        span.className = "amarillo fw-bold";
        buro.value = "Regular";
        barra.style.background = "orange";
      } else {
        span.className = "verde fw-bold";
        buro.value = "Bueno";
        barra.style.background = "green";
      }
    }

    function calcular() {
      const monto = parseFloat(document.getElementById('monto').value);
      const meses = parseInt(document.getElementById('meses').value);
      const score = parseInt(document.getElementById('score').value);
      const ingresos = parseFloat(document.getElementById('ingresos').value);
      
      // Validación: monto no puede ser mayor que ingresos mensuales
      if (monto > ingresos) {
        document.getElementById('resultado').textContent =
          `Monto solicitado inválido. No puede ser mayor que tus ingresos mensuales ($${ingresos.toFixed(2)}).`;
        document.getElementById('tablaPagos').innerHTML = "";
        return;
      }
      
      // Definir tasa según score
      let tasa;
      if (score <= 333) {
        tasa = 0.15; // 15%
      } else if (score <= 666) {
        tasa = 0.10; // 10%
      } else {
        tasa = 0.07; // 7% Banxico
      }
      
      // Pago mensual aproximado con interés simple
      const interesTotal = monto * tasa * (meses/12);
      const pagoMensual = (monto + interesTotal) / meses;
      
      document.getElementById('resultado').textContent =
        `Pago mensual aproximado: $${pagoMensual.toFixed(2)} con tasa ${(tasa*100).toFixed(2)}%`;
      
      // Generar tabla de pagos con acumulado
      let tabla = `<table class="table table-striped">
                    <thead><tr><th>Mes</th><th>Pago</th><th>Interés</th><th>Total acumulado</th></tr></thead><tbody>`;
      const capitalMensual = monto / meses;
      const interesMensual = interesTotal / meses;
      let acumulado = 0;
      
      for (let i = 1; i <= meses; i++) {
        const pago = capitalMensual + interesMensual;
        acumulado += pago;
        tabla += `<tr>
                    <td>${i}</td>
                    <td>$${pago.toFixed(2)}</td>
                    <td>$${interesMensual.toFixed(2)}</td>
                    <td>$${acumulado.toFixed(2)}</td>
                  </tr>`;
      }
      tabla += "</tbody></table>";
      document.getElementById('tablaPagos').innerHTML = tabla;
    }
  </script>
</body>
</html>